<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNN Deep Dive ScrollyTelling</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        pre { overflow-x: auto; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons (Lucide 대체용 SVG 컴포넌트) ---
        const Layers = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>;
        const ArrowDown = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>;
        const CodeIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>;
        const Calculator = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="14"></line><line x1="16" y1="18" x2="16" y2="18"></line><line x1="12" y1="14" x2="12" y2="14"></line><line x1="12" y1="18" x2="12" y2="18"></line><line x1="8" y1="14" x2="8" y2="14"></line><line x1="8" y1="18" x2="8" y2="18"></line></svg>;

        // --- Helper Components ---
        const CodeBlock = ({ title, code }) => (
            <div className="my-6 bg-slate-900 rounded-lg border border-slate-700 overflow-hidden shadow-lg">
                <div className="flex items-center px-4 py-2 bg-slate-800 border-b border-slate-700">
                    <CodeIcon className="w-4 h-4 mr-2 text-blue-400" />
                    <span className="text-xs font-mono text-slate-300">{title}</span>
                </div>
                <div className="p-4 overflow-x-auto">
                    <pre className="text-sm font-mono text-blue-100 whitespace-pre">
                        {code}
                    </pre>
                </div>
            </div>
        );

        const MathBlock = ({ title, children }) => (
            <div className="my-4 p-4 bg-slate-800/50 rounded-lg border-l-4 border-purple-500">
                <div className="flex items-center mb-2 text-purple-300 font-semibold text-sm">
                    <Calculator className="w-4 h-4 mr-2" />
                    {title}
                </div>
                <div className="font-mono text-lg text-slate-200">
                    {children}
                </div>
            </div>
        );

        // --- Visualizer Components ---
        const ConvVisualizer = () => {
            return (
                <div className="p-6 bg-slate-800 rounded-xl border border-slate-700 flex flex-col items-center gap-4">
                    <h3 className="text-blue-400 font-bold mb-2">Convolution Operation</h3>
                    <div className="flex items-center gap-4 relative">
                        {/* Input Image Grid */}
                        <div className="grid grid-cols-5 gap-1 p-2 bg-slate-900 rounded border border-slate-600">
                            {[...Array(25)].map((_, i) => (
                                <div key={i} className={`w-6 h-6 flex items-center justify-center text-xs border ${i === 12 ? 'border-yellow-400 bg-yellow-400/20 text-yellow-200' : 'border-slate-700 text-slate-500'}`}>
                                    {Math.floor(Math.random() * 9)}
                                </div>
                            ))}
                            {/* Moving Filter Representation */}
                            <div className="absolute top-2 left-2 w-[5.5rem] h-[5.5rem] border-2 border-yellow-400 rounded pointer-events-none animate-pulse shadow-[0_0_15px_rgba(250,204,21,0.3)]"></div>
                        </div>

                        <div className="text-2xl text-slate-500">→</div>
                        
                        {/* Filter */}
                        <div className="grid grid-cols-3 gap-1 p-1 bg-yellow-900/30 border border-yellow-600 rounded">
                            {[...Array(9)].map((_, i) => (
                                <div key={i} className="w-4 h-4 bg-yellow-500/20"></div>
                            ))}
                            <div className="absolute -bottom-6 w-full text-center text-xs text-yellow-500">Filter</div>
                        </div>

                        <div className="text-2xl text-slate-500">=</div>

                        {/* Feature Map */}
                        <div className="grid grid-cols-3 gap-1 p-2 bg-slate-900 rounded border border-blue-500/50">
                            {[...Array(9)].map((_, i) => (
                                <div key={i} className={`w-6 h-6 flex items-center justify-center text-xs border ${i===4 ? 'bg-blue-500 text-white font-bold' : 'border-slate-700 text-slate-500'}`}>
                                    {i===4 ? '9' : Math.floor(Math.random() * 5)}
                                </div>
                            ))}
                        </div>
                    </div>
                    <p className="text-xs text-slate-400 text-center mt-2 max-w-xs">필터(노란색)가 이미지를 순회하며 특징(Feature Map)을 추출합니다.</p>
                </div>
            );
        };

        const PoolingVisualizer = () => {
            return (
                <div className="p-6 bg-slate-800 rounded-xl border border-slate-700 flex flex-col items-center gap-6">
                    <h3 className="text-green-400 font-bold">Max Pooling (2x2)</h3>
                    <div className="flex items-center gap-8">
                        {/* 4x4 Input */}
                        <div className="grid grid-cols-4 gap-1 p-2 bg-slate-900 rounded relative">
                            {[1,0,2,3, 4,6,6,8, 3,1,1,0, 1,2,2,4].map((val, i) => (
                                <div key={i} className={`w-8 h-8 flex items-center justify-center border font-mono ${[5,6,9,10].includes(i) ? 'bg-green-500/20 border-green-500 text-green-300 font-bold' : 'border-slate-700 text-slate-600'}`}>
                                    {val}
                                </div>
                            ))}
                            {/* Focus Box */}
                            <div className="absolute top-[2.75rem] left-[2.75rem] w-[4.5rem] h-[4.5rem] border-2 border-green-400 rounded pointer-events-none"></div>
                        </div>

                        <div className="text-2xl text-slate-500">→</div>

                        {/* 2x2 Output */}
                        <div className="grid grid-cols-2 gap-1 p-2 bg-slate-900 rounded border border-slate-600">
                             {[6, 8, 3, 4].map((val, i) => (
                                <div key={i} className={`w-8 h-8 flex items-center justify-center border font-mono ${val===6 ? 'bg-green-500 text-white font-bold shadow-[0_0_10px_rgba(34,197,94,0.5)]' : 'border-slate-700 text-slate-400'}`}>
                                    {val}
                                </div>
                            ))}
                        </div>
                    </div>
                    <p className="text-xs text-slate-400 text-center max-w-xs">영역 내 가장 큰 값(Max)만 남기고 크기를 줄입니다.</p>
                </div>
            );
        };

        const ArchitectureVisualizer = () => {
            return (
                <div className="p-6 bg-slate-800 rounded-xl border border-slate-700 flex flex-col items-center">
                    <div className="flex items-center gap-2 mb-4 overflow-x-auto w-full justify-center">
                        <div className="flex flex-col items-center">
                            <div className="w-12 h-12 bg-slate-700 border border-slate-500 mb-2"></div>
                            <span className="text-[10px] text-slate-400">Input</span>
                        </div>
                        <div className="w-4 h-0.5 bg-slate-600"></div>
                        
                        {/* Layers */}
                        {[...Array(3)].map((_,i) => (
                            <React.Fragment key={i}>
                                <div className="flex flex-col gap-0.5">
                                    {[...Array(i+2)].map((_, j) => (
                                        <div key={j} className="w-2 h-8 bg-blue-500/40 border border-blue-400/50"></div>
                                    ))}
                                </div>
                                <div className="w-4 h-0.5 bg-slate-600"></div>
                            </React.Fragment>
                        ))}
                        
                        <div className="flex flex-col gap-1">
                            <div className="w-2 h-20 bg-purple-500/40 border border-purple-400"></div>
                        </div>
                         <div className="w-4 h-0.5 bg-slate-600"></div>
                        <div className="text-xs font-bold text-white">Class</div>
                    </div>
                    <div className="text-xs text-slate-400 font-mono">Image &rarr; Conv &rarr; Pool &rarr; FC</div>
                    <p className="text-xs text-slate-500 mt-2 text-center">깊어질수록 이미지는 추상화되고,<br/>필터 수는 늘어납니다.</p>
                </div>
            );
        }

        const FCVisualizer = () => {
            return (
                <div className="p-6 bg-slate-800 rounded-xl border border-slate-700 flex flex-col items-center gap-4">
                    <h3 className="text-purple-400 font-bold">Fully Connected Layer</h3>
                    <div className="flex items-center gap-6">
                        {/* Flattened */}
                        <div className="flex flex-col gap-0.5 p-1 bg-slate-900 border border-slate-700 rounded">
                            {[...Array(8)].map((_, i) => (
                                <div key={i} className="w-4 h-4 bg-blue-500/30 border border-blue-500/50 text-[8px] flex items-center justify-center"></div>
                            ))}
                            <div className="text-[8px] text-center text-slate-500 mt-1">Flatten</div>
                        </div>
                        
                        {/* Connections */}
                        <div className="flex flex-col justify-center gap-1 opacity-50">
                           <div className="w-8 h-px bg-slate-400 rotate-12"></div>
                           <div className="w-8 h-px bg-slate-400 -rotate-12"></div>
                           <div className="w-8 h-px bg-slate-400 rotate-6"></div>
                        </div>

                        {/* Classification */}
                        <div className="flex flex-col gap-2">
                             <div className="flex items-center gap-2">
                                <div className="w-24 h-4 bg-slate-700 rounded overflow-hidden">
                                    <div className="h-full bg-red-500 w-[10%]"></div>
                                </div>
                                <span className="text-xs text-slate-400">Cat (10%)</span>
                             </div>
                             <div className="flex items-center gap-2">
                                <div className="w-24 h-4 bg-slate-700 rounded overflow-hidden border border-green-500">
                                    <div className="h-full bg-green-500 w-[85%]"></div>
                                </div>
                                <span className="text-xs text-green-400 font-bold">Dog (85%)</span>
                             </div>
                             <div className="flex items-center gap-2">
                                <div className="w-24 h-4 bg-slate-700 rounded overflow-hidden">
                                    <div className="h-full bg-blue-500 w-[5%]"></div>
                                </div>
                                <span className="text-xs text-slate-400">Car (5%)</span>
                             </div>
                        </div>
                    </div>
                    <p className="text-xs text-slate-400 text-center mt-2">특징(Feature)들을 종합하여 최종적으로 이미지를 분류합니다.</p>
                </div>
            )
        }

        // --- Main Application ---
        function CNNScrollyTelling() {
            const [activeSection, setActiveSection] = useState(0);

            useEffect(() => {
                const handleScroll = () => {
                    const sections = document.querySelectorAll('.content-section');
                    sections.forEach((section, index) => {
                        const rect = section.getBoundingClientRect();
                        // 화면 중간쯤 왔을 때 섹션 활성화
                        if (rect.top >= 0 && rect.top <= window.innerHeight / 2) {
                            setActiveSection(index);
                        }
                    });
                };
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const sectionsData = [
                {
                    id: "intro",
                    title: "CNN이란 무엇인가?",
                    visual: <ArchitectureVisualizer />,
                    content: (
                        <>
                            <p className="mb-4 text-lg leading-relaxed text-slate-300">
                                <strong className="text-blue-400">CNN(Convolutional Neural Network)</strong>은 이미지 분류 분야에서 탁월한 성능을 보여주는 딥러닝 아키텍처입니다. 동물이 시각 정보를 처리할 때 뇌가 작동하는 방식에 착안하여 만들어졌습니다.
                            </p>
                            <p className="mb-4 text-slate-400">핵심 아이디어는 두 가지의 반복입니다:</p>
                            <ul className="list-disc list-inside space-y-2 mb-4 text-slate-300 ml-2">
                                <li><span className="text-yellow-400 font-bold">Conv Layer (Convolution)</span>: 이미지의 특징을 추출</li>
                                <li><span className="text-green-400 font-bold">Pooling Layer</span>: 정보를 압축하고 요약</li>
                            </ul>
                        </>
                    )
                },
                {
                    id: "conv",
                    title: "Convolution Layer: 특징 추출",
                    visual: <ConvVisualizer />,
                    content: (
                        <>
                            <p className="mb-4 text-slate-300">
                                CNN의 심장과도 같은 부분입니다. <span className="text-yellow-400">Filter(필터)</span>라고 불리는 작은 윈도우가 이미지를 순회하며 특징을 잡아냅니다.
                            </p>
                            <p className="mb-4 text-slate-300">
                                이미지(입력)와 필터(가중치)의 각 요소를 곱한 뒤 모두 더하는 <strong>합성곱(Convolution)</strong> 연산을 수행합니다.
                            </p>
                            <MathBlock title="합성곱 연산">
                                Y(i,j) = &sum;(X &times; K) + b
                            </MathBlock>
                            <p className="text-sm text-slate-500 mt-2">* X: 입력 이미지, K: 필터(커널), b: 편향(Bias)</p>
                        </>
                    )
                },
                {
                    id: "pooling",
                    title: "Pooling Layer: 압축과 요약",
                    visual: <PoolingVisualizer />,
                    content: (
                        <>
                            <p className="mb-4 text-slate-300">
                                특징을 추출했다면, 이제 정보를 요약할 차례입니다. 이를 <strong>Down Sampling</strong>이라고 합니다.
                            </p>
                            <p className="mb-4 text-slate-300">
                                대표적인 방법은 <strong>Max Pooling</strong>입니다. 특정 영역에서 가장 큰 값(가장 두드러진 특징)만 남기고 나머지는 버립니다.
                            </p>
                            <MathBlock title="Max Pooling">
                                Y = max(Region of X)
                            </MathBlock>
                            <ul className="list-disc list-inside space-y-2 mt-4 text-slate-400 text-sm">
                                <li>이미지 크기가 줄어들어 연산량이 감소합니다.</li>
                                <li>특징이 더욱 뚜렷해지고(Sharpen), 작은 위치 변화에 덜 민감해집니다.</li>
                            </ul>
                            <CodeBlock title="PyTorch Example" code={`# 2x2 Max Pooling (크기가 절반으로 줄어듦)\npool_layer = nn.MaxPool2d(\n    kernel_size=2,\n    stride=2\n)`} />
                        </>
                    )
                },
                {
                    id: "deep",
                    title: "Conv + Pooling의 반복",
                    visual: <ArchitectureVisualizer />,
                    content: (
                        <>
                            <p className="mb-4 text-slate-300">
                                이미지가 깊은 레이어(Layer)를 통과할수록 <strong>추상화(Abstraction)</strong>됩니다. 뒤쪽 레이어로 갈수록 <strong>Filter의 개수는 늘어납니다.</strong>
                            </p>
                            <CodeBlock title="ReLU -> Pooling 반복 구조" code={`model = nn.Sequential(\n    # Layer 1\n    nn.Conv2d(3, 16, 3),   # 특징 추출\n    nn.ReLU(),             # 비선형성 (활성화 함수)\n    nn.MaxPool2d(2, 2),    # 압축\n\n    # Layer 2 (채널 수 증가: 16 -> 32)\n    nn.Conv2d(16, 32, 3),\n    nn.ReLU(),\n    nn.MaxPool2d(2, 2)\n)`} />
                            <p className="mt-4 text-sm text-slate-400">
                                이미지가 작아졌기 때문에(Pooling 덕분) 더 많은 필터를 써도 연산량 부담이 적으며, 추상적인 정보일수록 찾아낼 특징이 더 다양하기 때문입니다.
                            </p>
                        </>
                    )
                },
                {
                    id: "fc",
                    title: "FC Layer: 최종 분류",
                    visual: <FCVisualizer />,
                    content: (
                        <>
                            <p className="mb-4 text-slate-300">
                                추출과 압축을 반복하여 얻은 최종 <strong>Feature Map</strong>은 3차원 데이터입니다. 이를 분류하기 위해 한 줄로 쭉 폅니다(Flatten). 그리고 <strong>FC Layer (Fully Connected Layer)</strong>에 집어넣습니다.
                            </p>
                            <MathBlock title="Linear Layer">
                                Y = WX + b
                            </MathBlock>
                            <p className="text-sm text-slate-500 mb-4">* W: 가중치 행렬(Weight), X: 입력 벡터, b: 편향</p>
                            <p className="mb-4 text-slate-300">
                                이곳에서 최종적으로 "이 사진은 85% 확률로 쥐(Mouse)이다"와 같은 분류(Classification) 결론을 내리게 됩니다.
                            </p>
                            <CodeBlock title="PyTorch Example" code={`# 1차원으로 펴진 데이터를 입력받음\n# (512개 특징 -> 출력 10개 클래스)\nfc_layer = nn.Linear(\n    in_features=512,\n    out_features=10\n)`} />
                        </>
                    )
                }
            ];

            return (
                <div className="min-h-screen bg-slate-950 text-slate-200 selection:bg-blue-500 selection:text-white">
                    {/* Header */}
                    <header className="fixed top-0 left-0 right-0 z-50 bg-slate-950/80 backdrop-blur-md border-b border-slate-800 h-16 flex items-center justify-between px-6">
                        <div className="flex items-center gap-2">
                            <Layers className="text-blue-500 w-6 h-6" />
                            <span className="font-bold text-xl tracking-tight text-white">DeepDive: <span className="text-blue-400">CNN</span></span>
                        </div>
                        <div className="text-xs text-slate-500 font-mono hidden sm:block">
                            Original Text by hyundodo
                        </div>
                    </header>

                    {/* Hero Section */}
                    <section className="min-h-screen flex flex-col items-center justify-center pt-16 relative overflow-hidden">
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-blue-900/20 via-slate-950 to-slate-950"></div>
                        <div className="z-10 text-center px-4 max-w-4xl mx-auto">
                            <h1 className="text-6xl md:text-8xl font-black mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 text-transparent bg-clip-text">
                                Convolutional<br />Neural Network
                            </h1>
                            <p className="text-xl md:text-2xl text-slate-400 mb-12 font-light">
                                이미지가 컴퓨터에게 이해되는 과정.<br/>
                                필터와 풀링으로 이미지를 분해하고 해석하는 CNN의 구조를 알아보세요.
                            </p>
                            <div className="animate-bounce text-slate-500">
                                <ArrowDown className="w-8 h-8 mx-auto" />
                            </div>
                        </div>
                    </section>

                    {/* Main Content Grid */}
                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
                            
                            {/* Left Column: Text Content */}
                            <div className="flex flex-col gap-[50vh] pb-[50vh]">
                                {sectionsData.map((section, index) => (
                                    <div 
                                        key={section.id} 
                                        id={section.id} 
                                        className="content-section min-h-[60vh] flex flex-col justify-center pt-24"
                                    >
                                        <div className="flex items-center gap-3 mb-6">
                                            <span className="text-5xl font-black text-slate-800 select-none">0{index + 1}</span>
                                            <h2 className="text-3xl font-bold text-white">{section.title}</h2>
                                        </div>
                                        
                                        <div className="prose prose-invert prose-lg max-w-none text-slate-300">
                                            {section.content}
                                        </div>

                                        {/* Mobile Visual (Visible only on small screens) */}
                                        <div className="lg:hidden mt-8 border border-slate-700 rounded-xl overflow-hidden shadow-2xl">
                                            {section.visual}
                                        </div>
                                    </div>
                                ))}

                                {/* Conclusion Wrapper */}
                                <div className="min-h-[40vh] pt-24">
                                    <h2 className="text-3xl font-bold text-white mb-6">마치며: 전체 코드</h2>
                                    <p className="text-slate-400 mb-6">CNN의 전체적인 흐름을 하나의 파이토치 클래스로 구현하면 다음과 같습니다.</p>
                                    <CodeBlock title="SimpleCNN.py" code={`import torch.nn as nn\n\nclass SimpleCNN(nn.Module):\n    def __init__(self):\n        super().__init__()\n        # Feature Extraction\n        self.features = nn.Sequential(\n            nn.Conv2d(3, 16, 3), # Conv\n            nn.ReLU(),\n            nn.MaxPool2d(2, 2),  # Pool\n            nn.Conv2d(16, 32, 3),# Conv\n            nn.ReLU(),\n            nn.MaxPool2d(2, 2)   # Pool\n        )\n        # Classification\n        self.classifier = nn.Sequential(\n            nn.Flatten(),\n            nn.Linear(32 * 6 * 6, 10) # FC\n        )\n\n    def forward(self, x):\n        x = self.features(x)\n        x = self.classifier(x)\n        return x`} />
                                    <div className="flex gap-2 mt-4 text-sm text-slate-500 font-mono">
                                        <span>#DeepLearning</span>
                                        <span>#PyTorch</span>
                                        <span>#Math</span>
                                    </div>
                                </div>
                            </div>

                            {/* Right Column: Sticky Visuals (Visible only on large screens) */}
                            <div className="hidden lg:block relative">
                                <div className="sticky top-24 h-[calc(100vh-6rem)] flex items-center justify-center p-8 bg-slate-900/50 rounded-3xl border border-slate-800 backdrop-blur-sm shadow-2xl overflow-hidden transition-all duration-500">
                                    <div className="w-full max-w-md transform transition-all duration-500">
                                        {sectionsData[activeSection] ? sectionsData[activeSection].visual : <div className="text-slate-600">Explore CNN</div>}
                                    </div>
                                </div>
                            </div>

                        </div>
                    </main>

                    {/* Footer */}
                    <footer className="py-12 border-t border-slate-800 text-center text-slate-600">
                        <p>© 2022 hyundodo. Re-visualized with React & Tailwind.</p>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CNNScrollyTelling />);
    </script>
</body>
</html>