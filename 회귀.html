<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STATA 회귀분석: 교재 8장 상세 해설</title>
    
    <!-- Syntax Highlighting Theme -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">

    <!-- MathJax for LaTeX Rendering -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Custom Styles for Scrolling Layout -->
    <style>
        body {
            font-family: 'Noto Sans KR', 'Segoe UI', sans-serif;
            background-color: #f4f6f9;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border-radius: 12px;
        }

        h1 {
            font-size: 2.2em;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 10px;
        }

        h2 {
            font-size: 1.6em;
            color: #2980b9;
            margin-top: 50px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
            padding-left: 15px;
        }

        h3 {
            font-size: 1.2em;
            color: #34495e;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 700;
        }

        p, li {
            font-size: 1em;
            color: #444;
        }

        ul {
            padding-left: 20px;
        }

        /* Code Block Styling */
        pre {
            background-color: #1e1e1e;
            border-radius: 8px;
            margin: 15px 0;
            overflow-x: auto;
        }
        pre code {
            font-family: 'D2Coding', 'Consolas', monospace;
            font-size: 0.9em;
            padding: 20px;
            display: block;
            color: #dcdcdc;
        }

        .code-header {
            background: #e0e0e0;
            padding: 5px 15px;
            font-size: 0.75em;
            font-weight: bold;
            color: #555;
            border-radius: 8px 8px 0 0;
            border-bottom: 1px solid #ccc;
            margin-bottom: -15px; /* Pull code block up */
            position: relative;
            z-index: 1;
            width: fit-content;
            margin-top: 20px;
        }

        .explanation {
            background-color: #eaf6ff;
            border-left: 5px solid #3498db;
            padding: 15px 20px;
            margin-top: 15px;
            border-radius: 0 4px 4px 0;
            font-size: 0.95em;
        }

        .stata-cmd {
            color: #e74c3c;
            background-color: #fceceb;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            font-family: monospace;
        }

        .section-divider {
            height: 1px;
            background-color: #e0e0e0;
            margin: 50px 0;
        }

        .intro-box {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 40px;
            text-align: center;
        }

        .summary-box {
            background-color: #2c3e50;
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin-top: 60px;
        }
        .summary-box h2 {
            color: #3498db;
            border: none;
            padding: 0;
            margin-top: 0;
        }
        .summary-box p, .summary-box li {
            color: #ecf0f1;
        }
        .summary-box .stata-cmd {
            background-color: #34495e;
            color: #f1c40f;
        }

        /* Mobile Optimization */
        @media (max-width: 600px) {
            .container {
                margin: 0;
                border-radius: 0;
            }
            h1 { font-size: 1.8em; }
            h2 { font-size: 1.4em; }
        }
    </style>
</head>
<body>

<div class="container">

    <!-- Title Section -->
    <div class="intro-box">
        <h1>회귀분석 기초 (8장)</h1>
        <p style="font-size: 1.1em; color: #555;">STATA를 이용한 선형회귀분석의 추정과 해석</p>
        <hr style="width: 50px; border: 1px solid #bbb; margin: 15px auto;">
        <p>단순회귀부터 다중회귀, 가설검정, 그래프, 표 작성까지<br>
        초보자를 위한 상세 가이드</p>
    </div>

    <!-- 8.1 Section -->
    <div class="content-section">
        <h2>8.1 단순선형회귀모형의 이해</h2>
        <p><strong>기본 개념:</strong></p>
        <ul>
            <li>종속변수($y$)와 독립변수($x$)가 각각 하나씩 있는 모형입니다.</li>
            <li><strong>목표:</strong> $x$와 $y$의 선형관계($y = \alpha + \beta x + \epsilon$)를 결정하는 모수를 추정하는 것.</li>
            <li><strong>최소제곱법(OLS):</strong> 잔차(실제값과 예측값의 차이)의 제곱합을 최소화하는 선을 긋는 가장 일반적인 방법입니다.</li>
        </ul>
        
        <div class="explanation">
            <strong>BLUE (Best Linear Unbiased Estimator) 조건</strong><br>
            다음 5가지 가정이 만족되면 OLS 추정량은 '최우수 선형 불편 추정량'이 됩니다.<br>
            1) 선형성 &nbsp; 2) 오차항 기댓값 0 &nbsp; 3) 동분산성 &nbsp; 4) 오차항의 독립성 &nbsp; 5) 정규성
        </div>

        <h3>1) 단순회귀 분석 실행</h3>
        <div class="code-header">STATA Code</div>
        <pre><code class="stata">use "R_data8_1.dta"

// 단순회귀분석 실행: y변수 x변수 순서
reg food_exp income</code></pre>
        <div class="explanation">
            <span class="stata-cmd">reg</span> 명령어는 회귀분석(regression)을 수행합니다. 맨 앞에 종속변수(결과), 그 뒤에 독립변수(원인)를 적습니다.<br>
            <strong>해석 예시:</strong> 소득(income) 계수가 10.2라면? → 소득이 100달러 늘 때 식비가 평균 10.2달러 증가함.<br>
            <strong>상수항(_cons):</strong> 소득이 0일 때의 평균 식비 지출액(예: 83.4달러).
        </div>

        <h3>2) 산포도 행렬과 결정계수($R^2$)</h3>
        <div class="code-header">STATA Code</div>
        <pre><code class="stata">// 변수 간 관계를 산포도 행렬로 확인 (절반만 표시)
graph matrix income food_exp, half

// R-squared 수동 계산 (개념 이해용)
// 1 - (설명되지 않은 변동 SSE / 총변동 SST)
di 1-(e(rss)/(e(rss)+e(mss)))</code></pre>
        <div class="explanation">
            <strong>$R^2$ (모형 적합도):</strong> 0~1 사이의 값을 가지며, 내 모형이 데이터를 얼마나 잘 설명하는지 보여줍니다.<br>
            - <span class="stata-cmd">e(rss)</span>: 잔차 제곱합 (설명 못 한 부분)<br>
            - <span class="stata-cmd">e(mss)</span>: 모형 제곱합 (설명 한 부분)
        </div>

        <h3>3) 조정된 $R^2$와 상수항 없는 모형</h3>
        <div class="code-header">STATA Code</div>
        <pre><code class="stata">// Adjusted R-squared 계산
// 설명변수가 많아질수록 R^2가 무조건 커지는 단점을 보완
di 1-(1-e(r2))*((e(N)-1)/(e(N)-2)) 

// 상관계수 계산 및 비교
corr food_exp income
return list
di r(rho)^2    // 상관계수의 제곱 = 단순회귀의 R-squared

// 상수항(절편) 없이 원점을 통과하도록 강제
reg food_exp income, nocons</code></pre>
        <div class="explanation">
            <strong>Adjusted $R^2$:</strong> 쓸모없는 변수 추가 시 패널티를 부여한 지표입니다.<br>
            <span class="stata-cmd">nocons</span> 옵션은 절편($\alpha$)을 0으로 고정합니다. 논리적으로 $x=0$일 때 반드시 $y=0$이어야 하는 경우에만 사용합니다.
        </div>
    </div>

    <div class="section-divider"></div>

    <!-- 8.2 Section -->
    <div class="content-section">
        <h2>8.2 다중선형회귀모형의 추정</h2>
        <p>설명변수($x$)가 2개 이상인 경우입니다. (예제: SAT 성적 = 응시율 + 가계소득)</p>

        <h3>1) 다중회귀분석과 표준화 계수</h3>
        <div class="code-header">STATA Code</div>
        <pre><code class="stata">use "R_data8_2.dta"

// 다중회귀분석
reg csat percent income

// 표준화 계수(Beta) 확인
reg csat percent income, beta</code></pre>
        <div class="explanation">
            <span class="stata-cmd">beta</span> 옵션은 변수들의 단위가 다를 때(예: %와 달러) 영향력을 비교하기 위해 사용합니다. 모든 변수를 표준화했을 때의 계수이므로, 계수 크기를 직접 비교할 수 있습니다.
        </div>

        <h3>2) 표준화 계수의 원리 (상세)</h3>
        <div class="code-header">STATA Code (원리 이해용)</div>
        <pre><code class="stata">// 1. 먼저 조용히(qui) 회귀분석을 돌려 표본을 확정
qui reg csat percent income, beta 

// 2. y변수 표준화 (값 - 평균) / 표준편차
qui su csat if e(sample)==1 
gen csat_s=(csat-r(mean))/r(sd)

// 3. x변수들 표준화
qui su percent if e(sample)==1
gen percent_s=(percent-r(mean))/r(sd) 
qui su income if e(sample)==1
gen income_s=(income-r(mean))/r(sd)

// 4. 표준화된 변수로 상수항 없이 회귀분석 -> 위 Beta 결과와 동일
reg csat_s percent_s income_s, nocons</code></pre>
        <div class="explanation">
            STATA의 <span class="stata-cmd">beta</span> 옵션이 내부적으로 어떻게 작동하는지 보여주는 과정입니다. 데이터를 Z-score로 변환한 뒤 회귀분석을 하면, 그 계수가 바로 표준화 계수가 됩니다.
        </div>

        <h3>3) 결측치 처리와 로그 모형</h3>
        <div class="code-header">STATA Code</div>
        <pre><code class="stata">// 변수 간 상관계수 (결측치 처리 방식 차이)
pwcorr csat percent income // 짝별 삭제 (데이터가 있는 쌍끼리)
corr csat percent income   // 목록별 삭제 (하나라도 비면 전체 제외)

// 로그-레벨 모형 (Log-Level Model)
gen ln_csat = log(csat)    // y에 로그를 취함
reg ln_csat percent income</code></pre>
        <div class="explanation">
            회귀분석은 기본적으로 <strong>Listwise Deletion</strong>(하나라도 결측이면 제외)을 사용하므로, 상관계수 비교 시에도 <span class="stata-cmd">corr</span>을 써야 정확합니다.<br>
            <strong>로그 모형 해석:</strong> $y$에만 로그가 씌워진 경우, $x$가 1단위 증가할 때 $y$는 $(\beta \times 100)$% 변화한다고 해석합니다.
        </div>
    </div>

    <div class="section-divider"></div>

    <!-- 8.3 Section -->
    <div class="content-section">
        <h2>8.3 적합값과 잔차</h2>
        <div class="code-header">STATA Code</div>
        <pre><code class="stata">reg csat percent income

// 예측값(Fitted value, yhat) 생성
predict yhat

// 잔차(Residual, ehat) 생성
predict ehat, resid

// 결과 확인 (1~10번째 줄만)
list csat yhat ehat in 1/10

// 직접 계산으로 검증
gen yhat1 = _b[_cons] + _b[percent]*percent + _b[income]*income 
gen ehat1 = csat - yhat1
list yhat yhat1 ehat ehat1 in 1/5

// 표준오차 확인
di _se[percent] 
di _se[income]</code></pre>
        <div class="explanation">
            회귀분석 직후 <span class="stata-cmd">predict</span> 명령어를 사용합니다.<br>
            - <strong>yhat (적합값):</strong> 모형이 예측한 성적 ($\hat{y} = \hat{\alpha} + \hat{\beta_1}x_1 + \hat{\beta_2}x_2$)<br>
            - <strong>resid (잔차):</strong> 실제값과 예측값의 차이 ($e = y - \hat{y}$)<br>
            STATA는 회귀 계수를 <span class="stata-cmd">_b[]</span>, 표준오차를 <span class="stata-cmd">_se[]</span> 시스템 변수에 저장해둡니다.
        </div>
    </div>

    <div class="section-divider"></div>

    <!-- 8.4 Section -->
    <div class="content-section">
        <h2>8.4 추정계수의 유의성 검정</h2>
        <p>오차항이 정규분포를 따른다는 가정하에, 모수 베타의 유의성을 검정합니다.</p>
        <div class="code-header">STATA Code</div>
        <pre><code class="stata">reg lprice lnox ldist lproptax crime 

// t값 직접 계산해보기 (계수 / 표준오차)
di -0.9380/0.1459 

// 다양한 가설 검정 (F-test)
test lnox              // H0: lnox 계수 = 0 ?
test lnox = 1          // H0: lnox 계수 = 1 ?
test lnox + ldist = 1  // 선형 결합 검정
test (lnox+ldist=1)(lproptax=0) // 복합 가설

// 여러 변수 동시 검정
test lnox ldist lproptax crime 
testparm lnox ldist, equal // 두 계수가 같은지 검정
testparm l* // l로 시작하는 모든 변수 검정</code></pre>
        <div class="explanation">
            <span class="stata-cmd">test</span> 명령어는 회귀분석표 외에 연구자가 궁금해하는 특정 가설(예: "두 변수의 영향력이 동일한가?")을 통계적으로 검증할 때 사용합니다.
        </div>
    </div>

    <div class="section-divider"></div>

    <!-- 8.5 Section -->
    <div class="content-section">
        <h2>8.5 그래프를 이용한 분석</h2>
        
        <h3>1) 산포도와 적합선</h3>
        <div class="code-header">STATA Code</div>
        <pre><code class="stata">// 단순회귀: 산포도(scatter) + 적합선(lfit)
twoway (lfit food_exp income)(scatter food_exp income)

// 95% 신뢰구간(ci) 포함
twoway (lfitci food_exp income)(scatter food_exp income)</code></pre>

        <h3>2) 한계효과(Margins) 시각화</h3>
        <div class="code-header">STATA Code</div>
        <pre><code class="stata">// 노조 가입자(union==1) 대상 분석
reg wage age ttl_exp tenure if union==1 

// 근무연한(tenure) 0~25 변화 시 임금 예측 (다른 변수는 평균값 고정)
margins, at(tenure=(0(1)25)) atmeans noatlegend 

// 그래프 그리기 (선 그래프 + 실제 산포도)
marginsplot, noci recast(line) addplot((scatter wage tenure if union==1)) legend(off)</code></pre>
        <div class="explanation">
            <strong>Margins:</strong> "다른 조건이 평균일 때, 특정 변수(근무연한)만 변하면 결과(임금)가 어떻게 될까?"를 시뮬레이션합니다. <span class="stata-cmd">marginsplot</span>으로 그 결과를 시각화합니다.
        </div>
        
        <h3>3) 집단 간 비교 (코드 수정 설명)</h3>
        <div class="code-header">STATA Code</div>
        <pre><code class="stata">// 1. 비노조원(union==0) 분석 및 전체 평균값 저장
qui reg wage age ttl_exp tenure if union==0 
qui su age      // 요약통계
local age_mean=r(mean) // 평균값을 로컬 매크로에 저장
qui su ttl_exp
local exp_mean=r(mean)

// 2. 비노조원 그래프 (저장된 평균값 기준)
qui margins, at(tenure=(0(1)25) age=`age_mean' ttl_exp=`exp_mean') noatlegend
marginsplot, nocl recast(line)

// 3. 노조원 그래프 (동일한 평균값 기준 비교)
qui reg wage age ttl_exp tenure if union==1
margins, at(tenure=(0(1)25) age=`age_mean' ttl_exp=`exp_mean') noatlegend
marginsplot, nocl recast(line)</code></pre>
        <div class="explanation">
            <span class="stata-cmd">local</span> 변수를 사용하여 나이와 경력을 고정된 값(전체 평균)으로 설정합니다. 이를 통해 비노조원과 노조원을 공정하게 비교할 수 있습니다.
        </div>
    </div>

    <div class="section-divider"></div>

    <!-- 8.6 Section -->
    <div class="content-section">
        <h2>8.6 추정결과 표로 만들기</h2>
        <div class="code-header">STATA Code</div>
        <pre><code class="stata">reg lwg age wc hc inc if lwg>0 

// 기본 표 출력
estimates table

// 포맷 지정: 소수점 3자리, R^2 포함
estimates table, b(%9.3f) se(%9.3f) stats(r2) stfmt(%9.2f)

// 별표(*)로 유의수준 표시 (se와 동시 사용 불가)
estimates table, b(%9.3f) stats(r2) stfmt(%9.2f) star(0.01 0.05 0.1)</code></pre>

        <h3>여러 모델 비교 (estout 패키지)</h3>
        <div class="code-header">STATA Code</div>
        <pre><code class="stata">// 모델 1 저장
qui reg lwg age wc hc inc if lwg>0 
estimates store model1

// 모델 2 저장 (inc 변수 제외)
qui reg lwg age wc hc if lwg>0
estimates store model2

// 두 모델 비교 출력
estimates table model1 model2, stats(r2) b(%9.3f) style(column)

// estout 사용 (논문용 표 스타일)
// 설치: ssc install estout
estout, cells(b(star fmt(%9.3f)) se(par fmt(%9.3f))) ///
    starlevels(* 0.1 ** 0.05 *** 0.01) legend</code></pre>
        <div class="explanation">
            <span class="stata-cmd">estimates store</span>로 결과를 메모리에 저장한 뒤 나란히 비교합니다. <span class="stata-cmd">estout</span>은 논문에 바로 쓸 수 있는 깔끔한 표를 만들어주는 외부 명령어입니다.
        </div>
    </div>

    <!-- Summary Box -->
    <div class="summary-box">
        <h2>강의 요약</h2>
        <ul style="list-style-type: none; padding-left: 0;">
            <li style="margin-bottom: 10px;">✅ <strong>8.1 & 8.2:</strong> <span class="stata-cmd">reg</span> 명령어로 회귀모형을 추정하고 계수를 해석했습니다.</li>
            <li style="margin-bottom: 10px;">✅ <strong>8.3:</strong> <span class="stata-cmd">predict</span>로 잔차와 예측값을 구했습니다.</li>
            <li style="margin-bottom: 10px;">✅ <strong>8.4:</strong> <span class="stata-cmd">test</span>로 다양한 가설을 검정했습니다.</li>
            <li style="margin-bottom: 10px;">✅ <strong>8.5:</strong> <span class="stata-cmd">margins</span>와 <span class="stata-cmd">marginsplot</span>으로 결과를 시각화했습니다.</li>
            <li>✅ <strong>8.6:</strong> <span class="stata-cmd">estimates table</span>로 논문용 표를 만들었습니다.</li>
        </ul>
    </div>

</div>

<!-- Syntax Highlighting Script -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script>
    hljs.highlightAll();
</script>

</body>
</html>