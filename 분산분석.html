<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 3: Stata 분산분석 (ANOVA)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .code-block { font-family: 'Menlo', 'Monaco', 'Courier New', monospace; }
        .stata-output { font-family: 'Menlo', 'Monaco', 'Courier New', monospace; white-space: pre; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Header Section -->
    <header class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-12 shadow-lg">
        <div class="max-w-4xl mx-auto px-6">
            <h1 class="text-4xl font-bold mb-4"><i class="fas fa-chart-bar mr-3"></i>Chapter 3. 분산분석</h1>
            <p class="text-xl opacity-90">Stata 기초통계와 회귀분석: 일원분산분석부터 공분산분석(ANCOVA)까지</p>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-6 py-10 space-y-12">

        <!-- Intro Section -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-200 p-8">
            <h2 class="text-2xl font-bold text-indigo-700 mb-4 border-b pb-2">0. 분산분석(ANOVA) 개요</h2>
            <div class="prose max-w-none text-slate-600 space-y-4">
                <p>
                    <span class="font-semibold text-slate-800">분산 분석(Analysis of Variance, ANOVA)</span>은 
                    두 개 이상 다수의 집단을 서로 비교하고자 할 때, <strong>집단 내의 분산</strong>, <strong>총평균</strong>, 
                    그리고 <strong>각 집단의 평균 차이</strong>에 의해 생긴 <strong>집단 간 분산</strong>의 비교를 통해 
                    만들어진 F분포를 이용하여 가설검정을 하는 방법입니다.
                </p>
                <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
                    <h3 class="font-bold text-blue-800 mb-2">📌 기본 가정</h3>
                    <ul class="list-disc list-inside space-y-1">
                        <li>각 모집단은 정규분포를 따른다 (정규성).</li>
                        <li>각 모집단의 분산은 서로 같다 (등분산성).</li>
                        <li>각 모집단은 서로 독립이다 (독립성).</li>
                    </ul>
                </div>
                <p class="text-sm text-slate-500 mt-2">
                    * R.A. Fisher에 의해 개발되었으며, 평균을 직접 비교하지 않고 분산 비율(F값)을 통해 평균 차이를 검정합니다.<br>
                    * 참고: 이클래스에 올려진 "#8 분산분석 참고자료"를 확인하세요.
                </p>
            </div>
        </section>

        <!-- Section 1: One-way ANOVA -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="bg-indigo-50 px-8 py-4 border-b border-indigo-100 flex items-center">
                <div class="bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center mr-3 font-bold">1</div>
                <h2 class="text-xl font-bold text-indigo-800">일원분산분석 (One-way ANOVA)</h2>
            </div>
            
            <div class="p-8 space-y-6">
                <p class="text-slate-600">
                    특성값(종속변수)에 영향을 미치는 요인(독립변수)이 하나인 경우의 실험입니다.<br>
                    먼저 데이터를 불러오고 분석하기 좋은 형태(Long Type)로 변환합니다.
                </p>

                <!-- Code Step 1 -->
                <div class="space-y-2">
                    <h3 class="font-semibold text-slate-700 flex items-center"><i class="fas fa-terminal mr-2 text-sm text-slate-400"></i> 데이터 불러오기 및 전처리</h3>
                    <div class="bg-slate-800 rounded-lg p-4 overflow-x-auto">
                        <code class="code-block text-green-400 block mb-2">* 예제 파일 R_data3_1 실행</code>
                        <code class="code-block text-green-400 block mb-2">* 경로 설정 (사용자 환경에 맞게 수정 필요)</code>
                        <code class="code-block text-white">use "/Users/NewSung/Dropbox/TEACHING/..."</code>
                    </div>
                </div>

                <!-- Code Step 2 -->
                <div class="space-y-2">
                    <h3 class="font-semibold text-slate-700 flex items-center"><i class="fas fa-layer-group mr-2 text-sm text-slate-400"></i> 데이터 구조 변환 (Wide → Long)</h3>
                    <p class="text-sm text-slate-500 mb-2">
                        ANOVA를 수행하기 위해서는 각 집단이 별도의 컬럼에 있는 것이 아니라, 하나의 컬럼에 값이 있고 
                        그룹을 구분하는 변수가 따로 있는 형태여야 합니다. <code>stack</code> 명령어가 이를 수행합니다.
                    </p>
                    <div class="bg-slate-800 rounded-lg p-4 overflow-x-auto">
                        <code class="code-block text-green-400 block mb-2">* 4개의 변수를 쌓아서(stack) 하나의 변수로 만듦</code>
                        <code class="code-block text-white block mb-1">stack stemcell_1-female_4, group(4)</code>
                        <code class="code-block text-green-400 block mb-2">* 변수명 변경: _stack은 party(그룹)로 변경</code>
                        <code class="code-block text-white block mb-1">rename (stemcell_1 female_1 _stack) (stemcell female party)</code>
                        <code class="code-block text-green-400 block mb-2">* 결측치 제거</code>
                        <code class="code-block text-white">drop if stemcell==.</code>
                    </div>
                </div>

                <!-- Code Step 3 -->
                <div class="space-y-2">
                    <h3 class="font-semibold text-slate-700 flex items-center"><i class="fas fa-search mr-2 text-sm text-slate-400"></i> 기초 통계량 확인</h3>
                    <div class="bg-slate-800 rounded-lg p-4 overflow-x-auto">
                        <code class="code-block text-white block mb-1">sum</code>
                        <code class="code-block text-white block mb-1">tab party</code>
                        <code class="code-block text-white block mb-1">tab female</code>
                        <code class="code-block text-white">tab party female</code>
                    </div>
                    <div class="bg-yellow-50 p-3 rounded text-sm text-yellow-800 border border-yellow-200">
                        <strong>변수 설명:</strong><br>
                        - <code>stemcell</code>: 줄기세포 연구 찬성 정도 (종속변수/반응변수)<br>
                        - <code>female</code>: 성별 더미변수<br>
                        - <code>party</code>: 정치 성향 (요인변수)
                    </div>
                </div>

                <!-- Code Step 4 -->
                <div class="space-y-2">
                    <h3 class="font-semibold text-slate-700 flex items-center"><i class="fas fa-calculator mr-2 text-sm text-slate-400"></i> 일원분산분석 실행 (oneway)</h3>
                    <p class="text-sm text-slate-500 mb-2">
                        <strong>귀무가설(H0):</strong> u1 = u2 = u3 = u4 (모든 정당 간 찬성 정도의 평균은 같다)
                    </p>
                    <div class="bg-slate-800 rounded-lg p-4 overflow-x-auto mb-2">
                        <code class="code-block text-white">oneway stemcell party</code>
                    </div>
                    
                    <!-- Output Simulation -->
                    <div class="bg-slate-100 border border-slate-300 rounded-lg p-4 stata-output text-xs md:text-sm text-slate-700 overflow-x-auto">
                        Analysis of Variance
    Source              SS         df      MS            F     Prob > F
------------------------------------------------------------------------
Between groups      92.7028986      3   30.9009662     12.46     0.0000
 Within groups      104.166667     42   2.48015873
------------------------------------------------------------------------
     Total          196.869565     45   4.37487923

Bartlett's test for equal variances:  chi2(3) =  20.1167  Prob>chi2 = 0.000
                    </div>
                    <div class="text-sm text-slate-600 mt-2">
                        <p><strong>💡 해석:</strong></p>
                        <ul class="list-disc list-inside ml-2">
                            <li><strong>Prob > F (p-value):</strong> 0.0000으로 0.05보다 작으므로 귀무가설을 기각합니다. 즉, <strong>정치 성향에 따라 줄기세포 연구 찬성 정도에 유의미한 차이가 있습니다.</strong></li>
                            <li><strong>Bartlett's test:</strong> 등분산성 검정입니다. Prob이 0.000이므로 등분산 가정이 위배되었을 가능성이 있습니다. (이 경우 <code>oneway ..., tabulate</code> 옵션 등을 고려하거나 비모수 검정 등을 고려할 수 있음)</li>
                        </ul>
                    </div>
                </div>

                <!-- Code Step 5 -->
                <div class="space-y-2">
                    <h3 class="font-semibold text-slate-700 flex items-center"><i class="fas fa-list-ol mr-2 text-sm text-slate-400"></i> 사후 검정 (Bonferroni)</h3>
                    <p class="text-sm text-slate-500 mb-2">
                        어떤 집단 간에 구체적으로 차이가 있는지 확인하기 위해 Bonferroni 사후 검정을 실시합니다.
                    </p>
                    <div class="bg-slate-800 rounded-lg p-4 overflow-x-auto mb-2">
                        <code class="code-block text-white">oneway stemcell party, bonferroni tabulate</code>
                    </div>
                     <!-- Output Simulation -->
                     <div class="bg-slate-100 border border-slate-300 rounded-lg p-4 stata-output text-xs md:text-sm text-slate-700 overflow-x-auto">
            |         Summary of stemcell
      party |        Mean   Std. Dev.       Freq.
------------+------------------------------------
          1 |           8   1.2060454          12
          2 |   4.6666667   2.6053558          12
          3 |           7   .78446454          14
          4 |        4.75   .88640526           8
------------+------------------------------------
      Total |   6.2608696   2.0916212          46

                        Comparison of stemcell by party
                                (Bonferroni)
Row Mean-|
Col Mean |          1          2          3
---------+---------------------------------
       2 |   -3.33333
         |      0.000
         |
       3 |         -1    2.33333
         |      0.684      0.003
         |
       4 |      -3.25    .083333      -2.25
         |      0.000      1.000      0.015
                    </div>
                     <div class="text-sm text-slate-600 mt-2">
                        <p><strong>💡 해석:</strong> 표 안의 숫자는 두 집단 간 평균 차이(위)와 p-value(아래)입니다.</p>
                        <ul class="list-disc list-inside ml-2">
                            <li>1번 그룹 vs 2번 그룹: p=0.000 (유의한 차이 있음)</li>
                            <li>1번 그룹 vs 3번 그룹: p=0.684 (차이 없음)</li>
                            <li>3번 그룹 vs 4번 그룹: p=0.015 (유의한 차이 있음)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Two-way ANOVA -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="bg-teal-50 px-8 py-4 border-b border-teal-100 flex items-center">
                <div class="bg-teal-600 text-white w-8 h-8 rounded-full flex items-center justify-center mr-3 font-bold">2</div>
                <h2 class="text-xl font-bold text-teal-800">다원분산분석 (Two-way ANOVA)</h2>
            </div>
            
            <div class="p-8 space-y-6">
                <p class="text-slate-600">
                    요인의 수준을 교차하여 집단 간 차이를 검증합니다. 예를 들어 만화영화 폭력성(2수준) x 성별(2수준)은 2x2 설계입니다.<br>
                    여기서는 <strong>Party(4수준) x Female(2수준)</strong> 설계를 분석합니다.
                </p>

                <div class="space-y-2">
                    <h3 class="font-semibold text-slate-700 flex items-center"><i class="fas fa-code mr-2 text-sm text-slate-400"></i> 데이터 재설정 및 분석 실행</h3>
                    <div class="bg-slate-800 rounded-lg p-4 overflow-x-auto">
                        <code class="code-block text-green-400 block mb-2">* 데이터를 다시 불러와 long type으로 전환 (앞 단계와 동일)</code>
                        <code class="code-block text-white block mb-1">stack stemcell_1-female_4, group(4)</code>
                        <code class="code-block text-white block mb-1">rename (stemcell_1 female_1 _stack) (stemcell female party)</code>
                        <code class="code-block text-white block mb-2">drop if stemcell==.</code>
                        
                        <code class="code-block text-green-400 block mb-2">* 이원분산분석 실행 (요인: party, female)</code>
                        <code class="code-block text-white">anova stemcell party female</code>
                    </div>

                     <!-- Output Simulation -->
                     <div class="bg-slate-100 border border-slate-300 rounded-lg p-4 stata-output text-xs md:text-sm text-slate-700 overflow-x-auto mt-2">
                          Number of obs =         46    R-squared     =  0.4727
                          Root MSE      =    1.59119    Adj R-squared =  0.4213

                  Source | Partial SS         df         MS        F    Prob>F
             -----------+----------------------------------------------------
                   Model |  93.062257          4   23.265564      9.19  0.0000
                         |
                   party |  92.616934          3   30.872311     12.19  0.0000
                  female |  .35935829          1   .35935829      0.14  0.7083
                         |
                Residual |  103.80731         41   2.5318856  
             -----------+----------------------------------------------------
                   Total |  196.86957         45   4.3748792
                    </div>
                     <div class="text-sm text-slate-600 mt-2">
                        <p><strong>💡 해석:</strong></p>
                        <ul class="list-disc list-inside ml-2">
                            <li><strong>Model:</strong> 전체 모델은 유의합니다 (F=9.19, p=0.000).</li>
                            <li><strong>party:</strong> 정치 성향은 유의한 영향을 미칩니다 (p=0.000).</li>
                            <li><strong>female:</strong> 성별은 유의한 영향이 없습니다 (p=0.7083).</li>
                        </ul>
                    </div>
                </div>

                <div class="space-y-2">
                    <h3 class="font-semibold text-slate-700 flex items-center"><i class="fas fa-project-diagram mr-2 text-sm text-slate-400"></i> 상호작용 효과 (Interaction Effect)</h3>
                    <p class="text-sm text-slate-500 mb-2">
                        두 요인이 결합하여 종속변수에 영향을 미치는지 확인합니다. Stata에서는 <code>#</code> 기호를 사용합니다.
                    </p>
                    <div class="bg-slate-800 rounded-lg p-4 overflow-x-auto">
                        <code class="code-block text-green-400 block mb-2">* Partial SS 옵션 명시</code>
                        <code class="code-block text-white block mb-2">anova stemcell party female,   partial</code>
                        
                        <code class="code-block text-green-400 block mb-2">* 상호작용항(party#female) 추가</code>
                        <code class="code-block text-white block mb-2">anova stemcell party female party#female,   partial</code>

                        <code class="code-block text-green-400 block mb-2">* 각 그룹별 평균 확인</code>
                        <code class="code-block text-white">table female party, contents(mean stemcell) f(%9.2f)</code>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: ANCOVA -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="bg-rose-50 px-8 py-4 border-b border-rose-100 flex items-center">
                <div class="bg-rose-600 text-white w-8 h-8 rounded-full flex items-center justify-center mr-3 font-bold">3</div>
                <h2 class="text-xl font-bold text-rose-800">연속형 변수가 포함된 분산분석 (ANCOVA)</h2>
            </div>
            
            <div class="p-8 space-y-6">
                <p class="text-slate-600">
                    분산분석 모형에 <strong>연속형 변수(공변량)</strong>를 포함시키는 경우입니다.<br>
                    Stata에서는 변수 앞에 <code>c.</code>를 붙여 연속형임을 명시하는 것이 중요합니다.
                </p>

                <!-- Code Step 1 -->
                <div class="space-y-2">
                    <h3 class="font-semibold text-slate-700 flex items-center"><i class="fas fa-play-circle mr-2 text-sm text-slate-400"></i> 분석 실행 (c.age 사용)</h3>
                    <div class="bg-slate-800 rounded-lg p-4 overflow-x-auto mb-2">
                         <code class="code-block text-green-400 block mb-2">* 예제 파일 R_data3_3 실행</code>
                         <code class="code-block text-green-400 block mb-2">* Dependent: prestg80(평판), Factor: sex, Covariate: age</code>
                        <code class="code-block text-white">anova prestg80 sex c.age</code>
                    </div>
                    
                     <!-- Output Simulation -->
                     <div class="bg-slate-100 border border-slate-300 rounded-lg p-4 stata-output text-xs md:text-sm text-slate-700 overflow-x-auto">
                          Number of obs =      2,634    R-squared     =  0.0028
                          Root MSE      =     13.894    Adj R-squared =  0.0021

                  Source | Partial SS         df         MS        F    Prob>F
             -----------+----------------------------------------------------
                   Model |  1436.5519          2  718.27595      3.72  0.0243
                         |
                     sex |  159.28391          1  159.28391      0.83  0.3638
                     age |  1260.1007          1  1260.1007      6.53  0.0107
                         |
                Residual |  507898.57      2,631  193.04393  
             -----------+----------------------------------------------------
                   Total |  509335.12      2,633  193.44289
                    </div>
                </div>

                <!-- Comparison Block -->
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                    <h4 class="font-bold text-yellow-800 mb-2">⚠️ 주의: c.을 붙이지 않았을 때의 차이</h4>
                    <p class="text-sm text-yellow-900 mb-2">
                        <code>c.age</code> 대신 <code>age</code>를 입력하면, Stata는 나이(age)를 연속형 변수가 아닌 
                        <strong>범주형 변수(Factor)</strong>로 인식합니다. 그 결과 자유도(df)가 급격히 증가합니다.
                    </p>
                    <div class="bg-slate-800 rounded p-3 overflow-x-auto mt-2">
                        <code class="code-block text-white">anova prestg80 sex age</code>
                    </div>
                    <div class="mt-2 text-xs font-mono bg-white p-2 rounded border border-yellow-200">
                        ...
                        Model |  24950.943         72  346.54088      1.83  0.0000
                        ...
                        age   |  24774.492         71  348.93651      1.84  0.0000
                    </div>
                    <p class="text-xs text-slate-500 mt-1">* age의 df가 71이 된 것을 확인할 수 있습니다 (나이의 종류만큼 그룹이 생김).</p>
                </div>

                <!-- Interaction Step -->
                <div class="space-y-2">
                    <h3 class="font-semibold text-slate-700 flex items-center"><i class="fas fa-compress-arrows-alt mr-2 text-sm text-slate-400"></i> 공변량과의 상호작용 분석</h3>
                    <p class="text-sm text-slate-500 mb-2">
                        성별(sex)과 나이(age)의 상호작용 효과를 검증합니다.
                    </p>
                    <div class="bg-slate-800 rounded-lg p-4 overflow-x-auto mb-2">
                        <code class="code-block text-green-400 block mb-2">* sex#c.age의 상호작용변수를 추가 입력</code>
                        <code class="code-block text-white">anova prestg80 sex c.age sex#c.age</code>
                    </div>

                     <!-- Output Simulation -->
                     <div class="bg-slate-100 border border-slate-300 rounded-lg p-4 stata-output text-xs md:text-sm text-slate-700 overflow-x-auto">
                  Source | Partial SS         df         MS        F    Prob>F
             -----------+----------------------------------------------------
                   Model |  1783.5081          3  594.50271      3.08  0.0264
                         |
                     sex |  477.08298          1  477.08298      2.47  0.1160
                     age |  1421.7775          1  1421.7775      7.37  0.0067
                 sex#age |  346.95623          1  346.95623      1.80  0.1801
                         |
                Residual |  507551.62      2,630  192.98541  
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200 mt-2">
                        <p class="font-bold text-green-800">✅ 최종 결론 해석</p>
                        <p class="text-sm text-green-800 mt-1">
                            <code>sex#age</code>의 p-value는 <strong>0.1801</strong>입니다.<br>
                            이는 유의수준 0.05보다 크므로, 귀무가설을 기각할 수 없습니다.<br>
                            즉, <strong>평균 직업평판(prestg80)의 차이를 발생시키는 데 있어 성별과 나이의 상호작용 효과는 없다고 말할 수 있습니다.</strong>
                        </p>
                    </div>
                </div>

            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-800 text-slate-400 py-8 text-center text-sm">
        <p>Stata Statistics & Regression Analysis - Chapter 3</p>
        <p class="mt-2 text-slate-600">Based on provided lecture notes.</p>
    </footer>

</body>
</html>